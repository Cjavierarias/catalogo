<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catálogo 3D</title>
  <!-- Tailwind CSS (solo para prototipo en GitHub Pages) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM desde jsDelivr (ESM) -->
  <script type="module">
    import React from 'https://cdn.jsdelivr.net/npm/react@18.2.0/+esm';
    import ReactDOM from 'https://cdn.jsdelivr.net/npm/react-dom@18.2.0/+esm';

    // Three.js y GLTFLoader desde jsDelivr
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.module.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.154.0/examples/jsm/loaders/GLTFLoader.js';

    // Componente del visor 3D
    function ModelViewer({ modelUrl }) {
      const mountRef = React.useRef(null);
      const [error, setError] = React.useState(null);

      React.useEffect(() => {
        if (!modelUrl) return;
        setError(null);
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        const camera = new THREE.PerspectiveCamera(45, mountRef.current.clientWidth / mountRef.current.clientHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(mountRef.current.clientWidth, mountRef.current.clientHeight);
        mountRef.current.innerHTML = '';
        mountRef.current.appendChild(renderer.domElement);

        const loader = new GLTFLoader();
        loader.load(
          modelUrl,
          (gltf) => {
            scene.add(gltf.scene);
          },
          undefined,
          (err) => {
            console.error('Error al cargar el modelo 3D:', err);
            setError('No se pudo cargar el modelo 3D.');
          }
        );

        const controls = new THREE.Object3D();
        scene.add(controls);
        let rotY = 0;
        const animate = () => {
          requestAnimationFrame(animate);
          if (!error) {
            rotY += 0.01;
            controls.rotation.y = rotY;
          }
          renderer.render(scene, camera);
        };
        animate();

        const handleResize = () => {
          if (mountRef.current) {
            const width = mountRef.current.clientWidth;
            const height = mountRef.current.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
          }
        };
        window.addEventListener('resize', handleResize);
        return () => {
          window.removeEventListener('resize', handleResize);
          if (mountRef.current) mountRef.current.innerHTML = '';
        };
      }, [modelUrl]);

      return (
        <div className="relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden">
          {error ? (
            <div className="absolute inset-0 flex items-center justify-center text-red-600">{error}</div>
          ) : (
            <div ref={mountRef} className="w-full h-full"></div>
          )}
        </div>
      );
    }

    // Componente principal
    function CatalogWebapp() {
      const suppliers = [
        { id: "samsung", name: "Samsung", color: "bg-blue-500" },
        { id: "tesla", name: "Tesla", color: "bg-red-500" },
        { id: "apple", name: "Apple", color: "bg-gray-800 text-white" },
        { id: "acme", name: "Acme Corp", color: "bg-green-600" },
      ];

      const products = [
        {
          id: "p1",
          supplier: "samsung",
          title: "Galaxy Super TV",
          price: "$1,299",
          img: "https://images.unsplash.com/photo-1555617117-08fda6c3d8b4?w=300&auto=format&fit=crop",
          featured: true,
          modelUrl: "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF/Duck.gltf"
        },
        {
          id: "p2",
          supplier: "tesla",
          title: "Model Z Toy Car",
          price: "$249",
          img: "https://images.unsplash.com/photo-1511919884226-fd3cad34687c?w=300&auto=format&fit=crop",
          featured: true,
          modelUrl: ""
        },
        {
          id: "p3",
          supplier: "apple",
          title: "Phone Pro Max",
          price: "$999",
          img: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=300&auto=format&fit=crop",
          featured: false,
          modelUrl: ""
        },
        {
          id: "p4",
          supplier: "acme",
          title: "Industrial Widget",
          price: "$49",
          img: "https://images.unsplash.com/photo-1518770660439-4636190af475?w=300&auto=format&fit=crop",
          featured: false,
          modelUrl: ""
        }
      ];

      const [selectedSupplier, setSelectedSupplier] = React.useState(null);
      const filteredProducts = selectedSupplier
        ? products.filter(p => p.supplier === selectedSupplier)
        : products.filter(p => p.featured);

      return (
        <div className="min-h-screen bg-gray-50 p-4 md:p-8">
          <header className="text-center mb-10">
            <h1 className="text-3xl font-bold text-gray-800">Catálogo 3D</h1>
            <p className="text-gray-600">Explora productos por proveedor</p>
          </header>

          {/* Proveedores (Categorías) */}
          <div className="flex flex-wrap gap-3 justify-center mb-8">
            <button
              onClick={() => setSelectedSupplier(null)}
              className={`px-4 py-2 rounded-full font-medium ${!selectedSupplier ? 'bg-indigo-600 text-white' : 'bg-gray-200'}`}
            >
              Destacados
            </button>
            {suppliers.map(s => (
              <button
                key={s.id}
                onClick={() => setSelectedSupplier(s.id)}
                className={`px-4 py-2 rounded-full font-medium ${selectedSupplier === s.id ? 'bg-indigo-600 text-white' : s.color}`}
              >
                {s.name}
              </button>
            ))}
          </div>

          {/* Productos */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProducts.map(p => (
              <div key={p.id} className="bg-white rounded-xl shadow-md overflow-hidden">
                <img src={p.img} alt={p.title} className="w-full h-48 object-cover" />
                <div className="p-4">
                  <h3 className="font-bold text-lg">{p.title}</h3>
                  <p className="text-gray-600">{p.price}</p>
                  {p.modelUrl && <ModelViewer modelUrl={p.modelUrl} />}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // Render principal
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(CatalogWebapp));
  </script>
</head>
<body class="m-0">
  <div id="root" class="min-h-screen bg-gray-100">Cargando...</div>
</body>
</html>
